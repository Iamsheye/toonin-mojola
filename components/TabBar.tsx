import { View, Platform, StyleSheet } from "react-native";
import { useLinkBuilder, useTheme } from "@react-navigation/native";
import { Text, PlatformPressable, Button } from "@react-navigation/elements";
import { type BottomTabBarProps } from "@react-navigation/bottom-tabs";
import { useSafeAreaInsets } from "react-native-safe-area-context";

import Svg, {
  Circle,
  Rect,
  Path,
  G,
  ClipPath,
  Defs,
  SvgProps,
} from "react-native-svg";
import { Pressable } from "react-native-gesture-handler";

// Define the type for icon keys
type IconKeys = "index" | "deck" | "earworm" | "profile";

const TabBar = ({ state, descriptors, navigation }: BottomTabBarProps) => {
  const { colors } = useTheme();
  const { buildHref } = useLinkBuilder();
  const inset = useSafeAreaInsets();

  const icon = {
    index: (props: SvgProps) => (
      <Svg {...props} width={16} height={16} fill="none">
        <Path
          fill={props.fill || "#C0C3CF"}
          d="M5.208 0h5.584c.186 0 .329 0 .453.012.887.087 1.612.62 1.92 1.337H2.835C3.143.632 3.868.1 4.755.012 4.879 0 5.022 0 5.208 0ZM3.448 2.178c-1.112 0-2.024.672-2.329 1.564a2.056 2.056 0 0 0-.018.056c.319-.097.65-.16.986-.203.864-.11 1.956-.11 3.225-.11H10.826c1.268 0 2.36 0 3.225.11.336.043.667.106.986.203a1.84 1.84 0 0 0-.019-.056c-.304-.892-1.216-1.564-2.329-1.564H3.45Z"
        />
        <Path
          fill={props.fill || "#C0C3CF"}
          fillRule="evenodd"
          d="M5.338 4.434h5.324c2.7 0 4.05 0 4.808.79.758.789.58 2.008.223 4.448l-.338 2.313c-.28 1.913-.42 2.87-1.138 3.442C13.5 16 12.441 16 10.324 16H5.676c-2.117 0-3.176 0-3.893-.573-.718-.573-.858-1.53-1.138-3.442L.307 9.672c-.357-2.44-.535-3.66.223-4.449.758-.79 2.108-.79 4.808-.79ZM4.8 12.8c0-.331.298-.6.667-.6h5.066c.369 0 .667.269.667.6 0 .332-.298.6-.667.6H5.467c-.369 0-.667-.268-.667-.6Z"
          clipRule="evenodd"
        />
      </Svg>
    ),
    deck: (props: SvgProps) => (
      <Svg width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
        <Path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M11.8334 1.48114V5.30992C11.8334 5.7 11.6384 6.06427 11.3139 6.28064L9.61073 7.41607C9.38097 7.56924 9.07053 7.50715 8.91736 7.27739C8.76418 7.04763 8.82627 6.73719 9.05603 6.58402L10.7592 5.44859C10.8055 5.41768 10.8334 5.36564 10.8334 5.30992V1.3792C10.0628 1.33337 9.13365 1.33337 7.99999 1.33337C4.8573 1.33337 3.28595 1.33337 2.30964 2.30968C1.33333 3.286 1.33333 4.85734 1.33333 8.00004C1.33333 11.1427 1.33333 12.7141 2.30964 13.6904C3.28595 14.6667 4.8573 14.6667 7.99999 14.6667C11.1427 14.6667 12.714 14.6667 13.6904 13.6904C14.6667 12.7141 14.6667 11.1427 14.6667 8.00004C14.6667 4.85734 14.6667 3.286 13.6904 2.30968C13.2343 1.85367 12.6485 1.61065 11.8334 1.48114ZM4.16666 8.00004C4.16666 5.88295 5.8829 4.16671 7.99999 4.16671C8.3998 4.16671 8.78622 4.22808 9.14982 4.34228C9.41327 4.42503 9.55976 4.70568 9.47702 4.96913C9.39427 5.23259 9.11362 5.37908 8.85017 5.29633C8.58241 5.21223 8.29699 5.16671 7.99999 5.16671C6.43519 5.16671 5.16666 6.43523 5.16666 8.00004C5.16666 9.56485 6.43519 10.8334 7.99999 10.8334C9.5648 10.8334 10.8333 9.56485 10.8333 8.00004C10.8333 7.7239 11.0572 7.50004 11.3333 7.50004C11.6095 7.50004 11.8333 7.7239 11.8333 8.00004C11.8333 10.1171 10.1171 11.8334 7.99999 11.8334C5.8829 11.8334 4.16666 10.1171 4.16666 8.00004ZM6.66666 7.50004C6.9428 7.50004 7.16666 7.7239 7.16666 8.00004C7.16666 8.46028 7.53976 8.83337 7.99999 8.83337C8.27614 8.83337 8.49999 9.05723 8.49999 9.33337C8.49999 9.60952 8.27614 9.83337 7.99999 9.83337C6.98747 9.83337 6.16666 9.01256 6.16666 8.00004C6.16666 7.7239 6.39052 7.50004 6.66666 7.50004Z"
          fill={props.fill || "#C0C3CF"}
        />
      </Svg>
    ),
    earworm: (props: SvgProps) => (
      <Svg width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
        <Path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M4.82624 1.64097C3.43416 1.90121 2.37483 3.03582 2.21401 4.43883L2.20355 4.53015C2.04445 5.91811 1.97862 7.31401 2.00605 8.70854L2.32861 8.98972C2.61954 9.24335 3.42013 9.91096 5.28023 10.2677C5.49405 9.73052 5.7972 9.29513 6.22744 8.98902C6.71937 8.63902 7.31848 8.50004 8.00009 8.50004C8.68169 8.50004 9.2808 8.63902 9.77273 8.98902C10.2033 9.29539 10.5066 9.73127 10.7205 10.269C11.3146 10.1553 11.796 10.0101 12.1842 9.85812C13.0398 9.52315 13.4633 9.14762 13.6617 8.96532L13.9935 8.66043C14.0228 7.2268 13.9532 5.79175 13.785 4.36544C13.6244 3.00514 12.5956 1.90684 11.2454 1.65442L11.0301 1.61417C9.02736 1.23978 6.9723 1.23978 4.9696 1.61417L4.82624 1.64097ZM5.65932 3.31993C5.8687 3.13989 5.89249 2.82421 5.71246 2.61482C5.53242 2.40544 5.21674 2.38164 5.00735 2.56168C4.69601 2.82938 4.5 3.22798 4.5 3.60747C4.5 4.28326 5.01137 4.74786 5.60209 5.01739C6.20925 5.29443 7.03705 5.4408 8 5.4408C8.96295 5.4408 9.79075 5.29443 10.3979 5.01739C10.9886 4.74786 11.5 4.28326 11.5 3.60747C11.5 3.19179 11.2698 2.85903 10.9926 2.6207C10.7833 2.44067 10.4676 2.46446 10.2875 2.67385C10.1075 2.88323 10.1313 3.19892 10.3407 3.37895C10.4906 3.50786 10.5 3.58744 10.5 3.60747C10.5 3.70066 10.4318 3.90273 9.9828 4.10762C9.5502 4.305 8.878 4.4408 8 4.4408C7.122 4.4408 6.4498 4.305 6.0172 4.10762C5.56816 3.90273 5.5 3.70066 5.5 3.60747C5.5 3.5863 5.50705 3.53999 5.53624 3.47995C5.56453 3.42178 5.6068 3.36508 5.65932 3.31993Z"
          fill={props.fill || "#C0C3CF"}
        />
        <Path
          d="M8.00005 10.5001C7.37304 10.5001 6.811 10.4698 6.30761 10.4174C6.45026 10.1335 6.61782 9.93855 6.80717 9.80383C7.07708 9.6118 7.45056 9.50004 8.00009 9.50004C8.54962 9.50004 8.92309 9.6118 9.19301 9.80383C9.38251 9.93867 9.55021 10.1339 9.69294 10.4182C9.19111 10.47 8.62906 10.5001 8.00005 10.5001Z"
          fill={props.fill || "#C0C3CF"}
        />
        <Path
          d="M13.9349 10.0379C13.629 10.2658 13.1846 10.5404 12.5487 10.7893C11.55 11.1803 10.1003 11.5001 8.00005 11.5001C4.57533 11.5001 2.87348 10.6371 2.06147 10.0535C2.09506 10.5886 2.14242 11.123 2.20355 11.6563C2.36844 13.0949 3.49912 14.2342 4.94013 14.4138L5.61712 14.4981C5.94701 14.5392 6.11195 14.5598 6.2767 14.577C7.42232 14.6966 8.57734 14.6966 9.72297 14.577C9.88772 14.5598 10.0527 14.5392 10.3825 14.4981L10.9867 14.4228C12.4694 14.238 13.6315 13.0634 13.7965 11.5827L13.808 11.48C13.8614 11.0001 13.9038 10.5193 13.9349 10.0379Z"
          fill={props.fill || "#C0C3CF"}
        />
      </Svg>
    ),
    profile: () => (
      <Svg width="22" height="22" viewBox="0 0 22 22" fill="none">
        <G opacity="0.8">
          <Circle
            cx="11"
            cy="11"
            r="10.2586"
            fill="#FCCAA5"
            stroke="#0D0D12"
            stroke-width="1.48279"
          />
          <G clipPath="url(#clip0_138_18824)">
            <Rect x="4" y="4" width="14" height="14" rx="7" fill="#81AD6C" />
            <Path
              d="M7.4802 12.0951L10.6177 12.8684L10.938 12.222L11.3459 11.3941L12.0559 9.95992L10.0668 9.07368C9.98427 9.24803 7.4802 12.0951 7.4802 12.0951Z"
              fill="#FFA79B"
            />
            <Path
              d="M11.4655 11.3943L12.1151 10.0052L11.0626 9.53791C11.0078 10.154 11.1446 10.8606 11.4655 11.3943Z"
              fill="black"
            />
            <Path
              d="M9.47295 7.49199C9.69474 6.55248 11.9587 5.97476 12.3313 6.84436C12.6161 7.49245 13.3846 9.29612 13.2056 9.76569C12.8427 10.712 11.6551 10.7142 10.9526 10.1915C10.243 9.66389 9.25507 8.41829 9.47295 7.49199Z"
              fill="#FFA79B"
            />
            <Path
              d="M10.8468 7.23459C11.517 7.15506 12.1561 6.75441 12.2969 6.66217C12.7226 6.04602 12.1812 5.46244 11.1634 6.13838C10.3077 6.3056 9.30794 6.72581 9.27837 7.52569C8.96324 8.52306 9.59832 8.52973 9.95958 9.05221C10.155 8.91351 10.0853 8.58678 10.3234 8.44067C10.6738 8.21957 10.796 8.05665 10.8468 7.23459Z"
              fill="#952C28"
            />
            <Path
              d="M12.3404 8.60362C12.4134 8.59088 12.4935 8.58306 12.5613 8.54039C12.6341 8.49068 12.6904 8.38216 12.6038 8.31708C12.5681 8.29245 12.6084 8.23607 12.6441 8.2607C12.7236 8.32086 12.7435 8.43459 12.683 8.51917C12.6146 8.62981 12.4746 8.65422 12.3529 8.67545C12.3093 8.67689 12.2968 8.60506 12.3404 8.60362Z"
              fill="#D24A43"
            />
            <Path
              d="M11.5523 7.85909C11.5864 7.9157 11.6195 7.96621 11.6536 8.02282C11.6877 8.07943 11.5968 8.12131 11.5627 8.0647C11.5286 8.00809 11.4955 7.95758 11.4614 7.90097C11.4343 7.84936 11.5192 7.80858 11.5523 7.85909Z"
              fill="black"
            />
            <Path
              d="M12.5374 7.4645C12.5715 7.52111 12.6046 7.57163 12.6387 7.62824C12.6728 7.68485 12.5819 7.72673 12.5478 7.67012C12.5137 7.61351 12.4806 7.563 12.4465 7.50639C12.4134 7.45587 12.5033 7.40789 12.5374 7.4645Z"
              fill="black"
            />
            <Path
              d="M11.2533 7.57555C11.3105 7.54147 11.3739 7.50637 11.4322 7.47822C11.5068 7.43512 11.5716 7.55232 11.4908 7.59646C11.4336 7.63053 11.3702 7.66564 11.3119 7.69379C11.2373 7.73689 11.1725 7.61969 11.2533 7.57555Z"
              fill="#952C28"
            />
            <Path
              d="M12.2257 7.18272C12.2829 7.14865 12.3463 7.11354 12.4046 7.0854C12.4792 7.04229 12.544 7.1595 12.4632 7.20364C12.406 7.23771 12.3426 7.27282 12.2844 7.30096C12.2097 7.34407 12.145 7.22687 12.2257 7.18272Z"
              fill="#952C28"
            />
            <Path
              d="M11.7438 9.29101C11.8391 9.40342 11.9761 9.46579 12.126 9.4585C12.1699 9.45712 12.1813 9.52259 12.1375 9.52397C11.9631 9.53545 11.7996 9.46536 11.6889 9.33719C11.6632 9.29868 11.7192 9.25844 11.7438 9.29101Z"
              fill="#D24A43"
            />
            <Path
              d="M9.3921 8.93604C9.40788 8.59665 9.82548 8.28481 10.2524 8.45744C10.3682 8.80435 10.497 9.15515 10.6238 9.49386C10.4692 9.64006 10.0935 9.76363 9.82067 9.65682C9.51463 9.53728 9.37447 9.30069 9.3921 8.93604Z"
              fill="#FFA79B"
            />
            <Path
              d="M9.89155 8.90649C10.0034 8.97337 10.1224 9.04518 10.2343 9.11206C10.2699 9.1367 10.2347 9.1861 10.1941 9.16851C10.1869 9.16358 10.1798 9.15865 10.1727 9.15373L10.1656 9.1488C10.0608 9.08685 9.95606 9.0249 9.85131 8.96295C9.80962 8.93936 9.85091 8.8889 9.89155 8.90649Z"
              fill="#D24A43"
            />
            <Path
              d="M11.1432 21.3593C11.5135 18.6951 12.2988 10.9779 8.93101 11.0049C6.84328 11.0218 4.77104 13.7027 3.29848 18.4713C2.84438 19.9383 2.43198 21.6092 2.20143 23.2167C5.20319 22.6953 8.2519 22.265 11.1432 21.3593Z"
              fill="#D24A43"
            />
            <Path
              d="M7.68234 22.3978C7.68753 21.0766 7.73456 19.7539 7.78158 18.4312C7.84597 16.6291 8.26047 15.7134 8.33653 13.9092C6.95274 15.2544 5.63521 16.3079 5.57102 18.294C5.51553 19.9674 6.16815 21.4508 7.30434 22.4752C7.43363 22.4572 7.55507 22.4281 7.68234 22.3978Z"
              fill="black"
            />
            <Path
              d="M17.9056 23.8311C18.2643 22.9836 18.7153 22.1756 19.1196 21.3448C17.7776 20.7053 16.352 20.2954 15.0325 19.6076C14.9789 19.5798 14.8587 19.4824 14.8587 19.4824C14.8587 19.4824 11.7762 13.8677 10.9244 12.835C10.9244 12.835 11.7971 21.4481 11.873 21.7175C11.9537 21.9797 17.4659 23.7236 17.4659 23.7236L17.9056 23.8311Z"
              fill="#D24A43"
            />
            <Path
              d="M17.1927 22.5991C14.8794 21.7605 12.5402 21.1655 12.5402 21.1655C12.5402 21.1655 12.3155 20.4212 11.7011 16.7001C11.0808 12.9801 11.1823 11.9182 9.09434 11.3588C9.09434 11.3588 8.50981 11.4912 7.60178 12.8584C6.69374 14.2255 6.61946 19.7386 6.84182 22.6328C7.00157 24.6901 12.2979 26.0872 15.6077 25.8629C16.0704 24.7975 16.7947 23.6841 17.1927 22.5991Z"
              fill="#D24A43"
            />
            <Path
              d="M11.4693 13.7948C11.6372 15.8402 11.805 17.8856 11.9729 19.931C11.9763 19.9561 11.9747 19.9885 11.9781 20.0136C11.9525 19.9985 11.9336 19.9887 11.9081 19.9735C11.9047 19.9484 11.9005 19.917 11.9029 19.891C11.7367 17.8581 11.5714 15.8315 11.406 13.805C11.4001 13.761 11.4692 13.7499 11.4693 13.7948Z"
              fill="black"
            />
          </G>
        </G>
        <Defs>
          <ClipPath id="clip0_138_18824">
            <Rect x="4" y="4" width="14" height="14" rx="7" fill="white" />
          </ClipPath>
        </Defs>
      </Svg>
    ),
  };

  return (
    <View style={[styles.tabBar, { paddingBottom: inset.bottom + 16 }]}>
      {state.routes.map((route, index) => {
        const { options } = descriptors[route.key];
        const label =
          options.tabBarLabel !== undefined
            ? options.tabBarLabel
            : options.title !== undefined
            ? options.title
            : route.name;

        const isFocused = state.index === index;

        const onPress = () => {
          const event = navigation.emit({
            type: "tabPress",
            target: route.key,
            canPreventDefault: true,
          });

          if (!isFocused && !event.defaultPrevented) {
            navigation.navigate(route.name, route.params);
          }
        };

        const onLongPress = () => {
          navigation.emit({
            type: "tabLongPress",
            target: route.key,
          });
        };

        return (
          // <PlatformPressable
          //   key={route.name}
          //   style={styles.tabBarItem}
          //   href={buildHref(route.name, route.params)}
          //   accessibilityState={isFocused ? { selected: true } : {}}
          //   accessibilityLabel={options.tabBarAccessibilityLabel}
          //   testID={options.tabBarButtonTestID}
          //   onPress={onPress}
          //   onLongPress={onLongPress}>
          <Pressable
            key={route.name}
            onPress={onPress}
            style={{ flex: 1 }}
            onLongPress={onLongPress}>
            <View style={styles.tabBarItem}>
              {icon[route.name as IconKeys]({
                fill: isFocused ? "#AC74FD" : "#C0C3CF",
              })}

              <Text
                style={[
                  styles.labelText,
                  {
                    color: isFocused ? "#AC74FD" : "#C0C3CF",
                    fontWeight: isFocused ? 700 : 500,
                  },
                ]}>
                {label}
              </Text>
            </View>
          </Pressable>
          // </PlatformPressable>
        );
      })}
    </View>
  );
};

const styles = StyleSheet.create({
  tabBar: {
    position: "absolute",
    bottom: 0,
    flexDirection: "row",
    backgroundColor: "#FCFFF8",
    justifyContent: "center",
    paddingHorizontal: 28,
    paddingTop: 16,
    borderTopLeftRadius: 40,
    borderTopRightRadius: 40,
  },
  tabBarItem: {
    flex: 1,
    gap: 2,
    alignItems: "center",
    justifyContent: "center",
  },
  labelText: {
    fontSize: 12,
    fontFamily: "SaansTRIAL-Rular",
  },
});

export default TabBar;
